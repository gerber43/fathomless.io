
<html>
    <head>
        <style>
            @import url('https://fonts.cdnfonts.com/css/8bit-wonder');
            * {
            font-family: '8BIT WONDER', sans-serif;
            }
            html, body {
            margin:0;
            padding:0;
            }
            #canvas {
            display: grid;
            }
            #canvas div {
            display:flex;
            align-items:center;
            justify-content:center;
            background-size: contain;
            }
            
            .ascii {
            display:none;
            color:#eee;
            }
            .item,.obstacle,.entity {
            position:absolute;
            display:none;
            background-size: contain;
            background-repeat: no-repeat;
            }
            #inventory {
            transition:.75s;
            height:0;
            width:100vw;
            background:brown;
            position:absolute;
            bottom:0;
            left:0;
            display:flex;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            background-size: contain;
            background-image:url("https://cdn.openart.ai/stable_diffusion/43d58786e3a9d71b4bbebbd5eb9f40d1ff8cfd1a_2000x2000.webp");
            font-size:0;
            color:white;
            }
            #inventory div {
            height:10%;
            display:flex;
            align-items:center;
            justify-content:center;
            width:100%;
            }
            #inventory div img {
            height:100%;
            margin:20px;
            }
            #dialogue {
            display:none;
            align-items:center;
            justify-content:center;
            position:absolute;
            bottom:0;
            left:0;
            background-image:url("https://cdn.openart.ai/stable_diffusion/43d58786e3a9d71b4bbebbd5eb9f40d1ff8cfd1a_2000x2000.webp");
            color:white;
            font-size:30px;
            width:100vw;
            padding:20px 0 20px 0;
            background-size: contain;
            text-align:center;
            }
            #alert {
            display:none;
            align-items:center;
            justify-content:end;
            position:absolute;
            top:0;
            left:0;
            color:white;
            font-size:50px;
            width:100vw;
            padding:20px 0 20px 0;
            text-align:center;
            }
            #alert img {
            width:50px;
            height:50px;
            }
        </style>
    </head>
    <body onresize="scaleTextures()">
        <div style = "background-image:url('https://pics.craiyon.com/2023-11-27/3GgqY7BtS9eL6kwNUEI9RA.webp');display:flex;align-items:center;justify-content:center;width:100vw;height:100vh;">
            <div id = "canvas"></div>
        </div>
        <div id = "dialogue"></div>
        <div id = "alert"></div>
        <div id = "inventory">
            <div>
                <img src = "https://static-00.iconduck.com/assets.00/gold-coin-icon-512x512-ehq45y6s.png">
                <p id = "coins">0</p>
            </div>
        </div>
        <script>
            const tileObjects = JSON.parse('[{"name":"player","type":"entity","ascii":"0","color":"","icon":"https://png.pngtree.com/png-clipart/20230819/original/pngtree-vector-pixel-game-character-pixel-man-picture-image_8061303.png"},{"name":"grass","type":"tile","ascii":"1","color":"green","icon":"https://i.redd.it/5m8846s5ix601.png"},{"name":"water","ascii":"2","color":"blue","icon":"https://i.pinimg.com/originals/b0/85/9e/b0859e122c8132467eeb75938be9f196.gif"},{"name":"rock","type":"tile","ascii":"3","color":"gray","icon":"https://i.pinimg.com/originals/7e/db/82/7edb8292d55bfa11c6581e2877090cd3.png"},{"name":"snow","type":"tile","ascii":"4","color":"white","icon":"https://t4.ftcdn.net/jpg/01/43/85/03/360_F_143850377_OgntQnBp2GZbbEhMSpxJz4XZXRbuVmTk.jpg"},{"name":"dirt","ascii":"5","type":"tile","color":"brown","icon":"https://us.123rf.com/450wm/ravennka/ravennka1510/ravennka151000071/46939883-seamless-brown-pattern-8bit-pixel-dirt-mud-ground-texture.jpg"},{"name":"boulder","type":"obstacle","ascii":"6","color":"gray","icon":"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/6e263fbb-8760-4321-9692-8e0eb613acba/d72ns19-705ce806-22a6-4112-a4d4-64fcd2fd76dd.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzZlMjYzZmJiLTg3NjAtNDMyMS05NjkyLThlMGViNjEzYWNiYVwvZDcybnMxOS03MDVjZTgwNi0yMmE2LTQxMTItYTRkNC02NGZjZDJmZDc2ZGQucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.OesW2_WXo_xxNVvX_BU2eb_4mXhKlZUxo5yyb548bnY"},{"name":"coin","ascii":"7","type":"item","color":"","icon":"https://static-00.iconduck.com/assets.00/gold-coin-icon-512x512-ehq45y6s.png"},{"name":"blank","ascii":"","type":"","color":"","icon":""},{"name":"bridge","ascii":"9","type":"tile","color":"lightbrown","icon":"https://cdnb.artstation.com/p/assets/images/images/004/682/457/large/simon-sanchez-madera-tilex1.jpg?1485480359"},{"name":"crab","ascii":"10","type":"entity","color":"orange","icon":"https://static.vecteezy.com/system/resources/previews/019/527/042/non_2x/an-8-bit-retro-styled-pixel-art-illustration-of-a-red-pinching-crab-free-png.png"},{"name":"blob","ascii":"11","type":"entity","color":"pink","icon":"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/75f47e67-7d24-4b0d-9117-612db0666f40/db681xv-d50d10ad-e912-4123-b81a-ab40e4322cab.gif/v1/fill/w_894,h_894/pixel_blob_gif_by_gooverdose_db681xv-pre.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTkyMCIsInBhdGgiOiJcL2ZcLzc1ZjQ3ZTY3LTdkMjQtNGIwZC05MTE3LTYxMmRiMDY2NmY0MFwvZGI2ODF4di1kNTBkMTBhZC1lOTEyLTQxMjMtYjgxYS1hYjQwZTQzMjJjYWIuZ2lmIiwid2lkdGgiOiI8PTE5MjAifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.8esp8bRiR3JrkxuE0TFwyCY_A-VAwkHMSWGTlpb66Ec"}]');
            var playerCoordinates = [0,0];
            var playerHeading = [1,0];
            var currentMap = JSON.parse('[[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":6,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":11,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":6,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":0,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":1,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":9,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":9,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":9,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":10,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":9,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":9,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":2,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":6,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}],[{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":3,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":5,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":8,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}},{"tile":{"textureIndex":4,"rotation":0},"item":{"textureIndex":7,"rotation":0},"obstacle":{"textureIndex":8,"rotation":0},"entity":{"textureIndex":8,"rotation":0}}]]');
            var sizeX = sizeY = 0;   
            updateMap();
            var playerInventory = JSON.parse('{"coins": 0}');
            updateInventory();
            var levelStep = 0;
            var inventoryOpened = false;
            var editTypes = ["tile","item","obstacle","entity"];
            var editType = 0;
            createMessage("dialogue","Press WSAD or Arrow Keys To Move",4);
            function updateInventory() {
                document.getElementById("coins").innerHTML = playerInventory["coins"];
            }
            function updateMap() {
                var createTiles = false;
                if (sizeX != currentMap.length || sizeY != currentMap[0].length) {
                    createTiles = true;
                    sizeX = currentMap.length;
                    sizeY = currentMap[0].length;
                    document.getElementById('canvas').style.gridTemplateColumns = "repeat("+sizeX+",minmax(0, 1fr))";
                    document.getElementById('canvas').style.gridTemplateRows = "repeat("+sizeY+",minmax(0, 1fr))";
                    document.getElementById('canvas').innerHTML = "";     
                }
                for (var i = 0;i<sizeY;i++) {
                     for (var j = 0;j<sizeX;j++) {
                        if (createTiles) {
                            document.getElementById('canvas').innerHTML += '<div oncontextmenu = "editType=((editType+1)%editTypes.length)" onclick = "updateTexture(this.id,editTypes[editType])" class="tile" id = "'+j+','+i+'"><span class = "ascii "></span><div class = "entity"></div><div class = "item"></div><div class = "obstacle"></div></div>';
                        }
                        applyTexture('tile',j+","+i,currentMap[j][i]['tile']);
                        applyTexture("item",j+","+i,currentMap[j][i]['item']);
                        applyTexture("obstacle",j+","+i,currentMap[j][i]['obstacle']);
                        applyTexture("entity",j+","+i,currentMap[j][i]['entity']);
                        if (currentMap[j][i]["entity"]['textureIndex'] == 0) {
                            playerHeading = [j+1,i];
                            playerCoordinates = [j,i];
                        }
                     }
                }
                scaleTextures();
            }
            function updateTexture(tileId,type) {
                var x = tileId.split(",")[0];
                var y = tileId.split(",")[1];
                for (var i = 0; i<tileObjects.length;i++) {
                    currentMap[x][y][type]['textureIndex'] = (currentMap[x][y][type]['textureIndex']+1)%(tileObjects.length);
                    if (tileObjects[currentMap[x][y][type]['textureIndex']]["type"] == type || (tileObjects[currentMap[x][y][type]['textureIndex']]["type"] == "" && type != "tile")) {
                        break;
                    }
                }
                updateMap();
            }
            function applyTexture(type,tileId, object) {
                var selectedElement = (type == "tile")?document.getElementById(tileId):document.getElementById(tileId).querySelector('.'+type);
                if (object['textureIndex'] != 8) {
                    selectedElement.style.backgroundImage = 'url("'+tileObjects[object['textureIndex']]['icon']+'")';
                    selectedElement.style.display = "flex";
                    selectedElement.style.transform = (tileId == playerCoordinates[0]+","+playerCoordinates[1] && type == "entity" && object['rotation'] == 180)?('scaleX(-1)'):('rotate('+object['rotation']+'deg)');
                } else {
                    selectedElement.style.display = "none";
                    selectedElement.style.backgroundImage = 'url()';
                    selectedElement.style.transform = "rotate(0)";
                }
            }
            function createMessage(type,message,time) {
                if (document.getElementById(type).innerHTML != message) {
                    document.getElementById(type).innerHTML = message,time;
                    document.getElementById(type).style.display = "flex";
                    setTimeout(function() {
                        document.getElementById(type).style.display = "none";
                        document.getElementById(type).innerHTML = "";
                    }, time*1000);
                }
            }
            function scaleTextures() {
                var windowMinimum = Math.min(window.innerWidth,window.innerHeight);
                var tileMinimum = Math.min(window.innerWidth/sizeX,window.innerHeight/sizeY);
                document.getElementById('canvas').style.height = tileMinimum*sizeY;
                document.getElementById('canvas').style.width = tileMinimum*sizeX;
                document.querySelectorAll('.tile').forEach((item) => {
                        item.style.height = item.style.width = tileMinimum;
                });
                document.querySelectorAll('.item').forEach((item) => {
                        item.style.height = item.style.width = tileMinimum/2;
                });
                document.querySelectorAll('.obstacle').forEach((obstacle) => {
                        obstacle.style.height = obstacle.style.width = tileMinimum;
                });
                document.querySelectorAll('.entity').forEach((obstacle) => {
                        obstacle.style.height = obstacle.style.width = tileMinimum/1.5;
                });
            }
            function toggleAscii() {
                for (var i=0; i<sizeX;i++) {
                    for (var j=0; j<sizeY;j++) {
                        document.getElementById(i+","+j).querySelector('.ascii').style.display = "flex";
                        document.getElementById(i+","+j).style.background = "none";
                    }
                }
            }
            function toggleInventory() {
                document.getElementById('inventory').style.height = (inventoryOpened)?"0":"100vh";
                document.getElementById('inventory').style.fontSize = (inventoryOpened)?"0":"40px";
                inventoryOpened = !inventoryOpened;
            }
            function stepAction() {
                if (currentMap[playerCoordinates[0]][playerCoordinates[1]]['item']['textureIndex'] == 7) {
                    if (levelStep == 1) {
                        createMessage("dialogue","Press e to view your inventory",8);
                        levelStep++;
                    }
                    document.getElementById(playerCoordinates[0]+","+playerCoordinates[1]).querySelector('.item').style.display = "none";
                    currentMap[playerCoordinates[0]][playerCoordinates[1]]['item']['textureIndex'] = 8;
                    playerInventory["coins"] += 1;
                    updateInventory();
                    createMessage("alert",'+<img style = "width:50px;height:50px;" src = "https://static-00.iconduck.com/assets.00/gold-coin-icon-512x512-ehq45y6s.png">',1)
                }
                document.getElementById(playerCoordinates[0]+","+playerCoordinates[1]).querySelector('.item').style.backgroundImage = "url("+tileObjects[currentMap[playerCoordinates[0]][playerCoordinates[1]]['item']['textureIndex']]['icon']+")";
            }
            function movePlayer(x,y,currentCoordinates,type) {
                if (0 <= x && x < sizeX && 0 <= y && y < sizeY) {
                    if (currentMap[x][y]['entity']['textureIndex'] == 8 && currentMap[x][y]['tile']['textureIndex'] != 8 && currentMap[x][y]['obstacle']['textureIndex'] == 8 && currentMap[x][y]['tile']['textureIndex'] != 2) {
                        if (levelStep == 0) {
                            createMessage("dialogue","Collect the coins",4);
                            levelStep++;
                        }
                    currentMap[currentCoordinates[0]][currentCoordinates[1]]['entity'] = [currentMap[x][y]['entity'], currentMap[x][y]['entity'] = currentMap[currentCoordinates[0]][currentCoordinates[1]]['entity']][0];
                    applyTexture("entity",currentCoordinates[0]+","+currentCoordinates[1],currentMap[currentCoordinates[0]][currentCoordinates[1]]['entity']);
                    if (type == "player") {
                        playerCoordinates = [x,y];
                    }
                    applyTexture("entity",x+","+y,currentMap[x][y]['entity']);
                    stepAction();
                    } else {
                        if (type == "player") {
                            if (currentMap[x][y]['tile']['textureIndex'] == 2) {
                                    createMessage("dialogue","You can't swim!",4);
                            }
                            if (currentMap[x][y]['obstacle']['textureIndex'] == 6) {
                                createMessage("dialogue","If only there was a way to break this rock.",4);
                            }
                        }
                        return "ERROR_MOVE_COLLISION";
                    }
                } else {
                    if (type == "player") {
                        createMessage("dialogue","You can't access this area yet!",4);
                    }
                    return "ERROR_MOVE_FAIL";
                }
            }
            function moveDirection(direction) {
                if (!inventoryOpened) {
                    if (playerHeading[0] == playerCoordinates[0] + direction[0] && playerHeading[1] == playerCoordinates[1] + direction[1]) {
                        var moveCondition = movePlayer(playerCoordinates[0] + direction[0],playerCoordinates[1] + direction[1],playerCoordinates,"player");
                    } else {
                        currentMap[playerCoordinates[0]][playerCoordinates[1]]['entity']['rotation'] = (Math.atan2(direction[1], direction[0])*180)/Math.PI;
                        applyTexture("entity",playerCoordinates[0]+","+playerCoordinates[1],currentMap[playerCoordinates[0]][playerCoordinates[1]]['entity']);
                    }
                    playerHeading = [playerCoordinates[0]+direction[0],playerCoordinates[1]+direction[1]];
                }
            }
             setInterval(function() {
                        locateEntities();
                    }, 1000);
            function locateEntities() {
                 for (var i=0; i<sizeX;i++) {
                    for (var j=0; j<sizeY;j++) {
                        if (currentMap[i][j]['entity']['textureIndex'] != 8 && currentMap[i][j]['entity']['textureIndex'] != 0) {
                            var direction = Math.floor(Math.random() * 4);
                            switch (direction) {
                                case 0:
                                    movePlayer(i-1,j,[i,j],tileObjects[currentMap[i][j]['entity']['textureIndex']]);
                                    break;
                                case 1:
                                    movePlayer(i+1,j,[i,j],tileObjects[currentMap[i][j]['entity']['textureIndex']]);
                                    break;
                                case 2:
                                    movePlayer(i,j-1,[i,j],tileObjects[currentMap[i][j]['entity']['textureIndex']]);
                                    break;
                                case 3:
                                    movePlayer(i,j+1,[i,j],tileObjects[currentMap[i][j]['entity']['textureIndex']]);
                                    break;
                            }
                        }
                    }
                }
            }
            document.addEventListener('keyup', (e) => {
                if (e.code === "ArrowLeft" || e.code === "KeyA")  {
                   moveDirection([-1,0]);
                }
                if (e.code === "ArrowRight" || e.code === "KeyD")  {
                    moveDirection([1,0]);
                }
                if (e.code === "ArrowUp" || e.code === "KeyW")  {
                    moveDirection([0,-1]);
                }
                if (e.code === "ArrowDown" || e.code === "KeyS")  {
                    moveDirection([0,1]);
                }
                 if (e.code === "KeyE")  {
                    toggleInventory();
                }
            });
        </script>
    </body>
</html>